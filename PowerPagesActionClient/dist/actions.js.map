{"version":3,"file":"actions.js","sourceRoot":"","sources":["../actions.ts"],"names":[],"mappings":";;;AAGA,IAAiB,OAAO,CA8DvB;AA9DD,WAAiB,OAAO;IACpB,SAAgB,UAAU,CAAC,SAAiB,EAAE,MAAW,EAAE,SAAgC,EAAE,OAA8B;QACvH,IAAI,YAAY,GAAG,IAAI,CAAC;QACxB,IAAI,OAAO,MAAM,KAAK,QAAQ,IAAI,MAAM,YAAY,MAAM;YACtD,YAAY,GAAG,MAAM,CAAC;aACrB,IAAI,OAAO,MAAM,KAAK,QAAQ,IAAI,MAAM,KAAK,IAAI;YAClD,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;QAE1C,IAAI,GAAG,GAAG,oDAAoD,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE,0BAA0B,SAAS,GAAG,CAAA;QAC5H,IAAI,YAAY;YACZ,GAAG,IAAI,uBAAuB,YAAY,GAAG,CAAA;QAEjD,QAAQ,CAAC;YACL,IAAI,EAAE,KAAK;YACX,GAAG,EAAE,GAAG;YACR,OAAO,EAAE,CAAC,IAAS,EAAE,EAAE,CAAC,eAAe,CAAC,IAAI,EAAE,SAAS,EAAE,OAAO,CAAC;YACjE,KAAK,EAAE,CAAC,KAAU,EAAE,EAAE,CAAC,aAAa,CAAC,KAAK,EAAE,OAAO,CAAC;SACvD,CAAC,CAAC;IACP,CAAC;IAjBe,kBAAU,aAiBzB,CAAA;IACD,OAAO,CAAC,UAAU,GAAG,UAAU,CAAC;IAEhC,SAAS,eAAe,CAAC,IAAS,EAAE,SAAgC,EAAE,OAA8B;QAChG,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;QAClB,IAAI,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;QAC3B,IAAI,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC;QAC7C,IAAI,MAAM,CAAC,UAAU,IAAI,SAAS;YAC9B,SAAS,CAAC,OAAO,CAAC,CAAC;;YAEnB,OAAO,CAAC,OAAO,CAAC,CAAC;IACzB,CAAC;IAED,SAAS,aAAa,CAAC,KAAmB,EAAE,OAA8B;QACtE,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;QACnB,IAAI,KAAK,CAAC,MAAM,IAAI,GAAG;YACnB,OAAO,CAAC,EAAE,OAAO,EAAE,gLAAgL,EAAC,CAAC,CAAA;;YAErM,OAAO,CAAC,KAAK,CAAC,YAAY,CAAC,CAAC;IACpC,CAAC;IAED,SAAS,QAAQ,CAAC,WAAgB;QAC9B,IAAI,YAAY,GAAG,CAAC,CAAC,QAAQ,EAAE,CAAC;QAEhC,KAAK,CAAC,gBAAgB,EAAE,CAAC,IAAI,CAAC,UAAU,KAAa;YACjD,IAAI,CAAC,WAAW,CAAC,OAAO,EAAE;gBACtB,CAAC,CAAC,MAAM,CAAC,WAAW,EAAE;oBAClB,OAAO,EAAE;wBACL,4BAA4B,EAAE,KAAK;qBACtC;iBACJ,CAAC,CAAC;aACN;iBAAM;gBACH,WAAW,CAAC,OAAO,CAAC,4BAA4B,CAAC,GAAG,KAAK,CAAC;aAC7D;YACD,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC;iBACd,IAAI,CAAC,UAAU,IAAI,EAAE,UAAU,EAAE,KAAK;gBACnC,oBAAoB,CAAC,IAAI,EAAE,UAAU,EAAE,KAAK,EAAE,YAAY,CAAC,OAAO,CAAC,CAAC;YACxE,CAAC,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;QACrC,CAAC,CAAC,CAAC,IAAI,CAAC;YACJ,YAAY,CAAC,UAAU,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;QAC7C,CAAC,CAAC,CAAC;QAEH,OAAO,YAAY,CAAC,OAAO,EAAE,CAAC;IAClC,CAAC;AACL,CAAC,EA9DgB,OAAO,GAAP,eAAO,KAAP,eAAO,QA8DvB","sourcesContent":["declare var shell: any;\r\ndeclare var validateLoginSession: (data: any, status: string, jqXHR: JQuery.jqXHR, resolve: (args: any) => void) => void; \r\n\r\nexport namespace actions {\r\n    export function callAction(operation: string, inputs: any, onSuccess: (output: any) => void, onError: (output: any) => void) {\r\n        let actionInputs = null;\r\n        if (typeof inputs === 'string' || inputs instanceof String)\r\n            actionInputs = inputs;\r\n        else if (typeof inputs === 'object' && inputs !== null)\r\n            actionInputs = JSON.stringify(inputs);\r\n\r\n        let url = `/_api/mwo_powerpagesactions?$filter=createdon ge ${new Date().toISOString()} and mwo_operation eq '${operation}'`\r\n        if (actionInputs)\r\n            url += ` and mwo_inputs eq '${actionInputs}'`\r\n\r\n        safeAjax({\r\n            type: \"GET\",\r\n            url: url,\r\n            success: (data: any) => successFunction(data, onSuccess, onError),\r\n            error: (jqXHR: any) => errorFunction(jqXHR, onError)\r\n        });\r\n    }\r\n    actions.callAction = callAction;\r\n\r\n    function successFunction(data: any, onSuccess: (output: any) => void, onError: (output: any) => void) {\r\n        console.log(data);\r\n        var record = data.value[0];\r\n        var outputs = JSON.parse(record.mwo_outputs);\r\n        if (record.statuscode == 407770001)\r\n            onSuccess(outputs);\r\n        else \r\n            onError(outputs);\r\n    }\r\n\r\n    function errorFunction(jqXHR: JQuery.jqXHR, onError: (output: any) => void) {\r\n        console.log(jqXHR);\r\n        if (jqXHR.status == 404)\r\n            onError({ message: \"Actions endpoint not found, please check whether you have configured the Site Settings 'Webapi/mwo_powerpagesaction/enabled: True' and 'Webapi/mwo_powerpagesaction/fields: *'\"})\r\n        else \r\n            onError(jqXHR.responseJSON);\r\n    }\r\n\r\n    function safeAjax(ajaxOptions: any) {\r\n        var deferredAjax = $.Deferred();\r\n\r\n        shell.getTokenDeferred().done(function (token: string) {\r\n            if (!ajaxOptions.headers) {\r\n                $.extend(ajaxOptions, {\r\n                    headers: {\r\n                        \"__RequestVerificationToken\": token\r\n                    }\r\n                });\r\n            } else {\r\n                ajaxOptions.headers[\"__RequestVerificationToken\"] = token;\r\n            }\r\n            $.ajax(ajaxOptions)\r\n                .done(function (data, textStatus, jqXHR) {\r\n                    validateLoginSession(data, textStatus, jqXHR, deferredAjax.resolve);\r\n                }).fail(deferredAjax.reject);\r\n        }).fail(function (this: any) {\r\n            deferredAjax.rejectWith(this, arguments);\r\n        });\r\n\r\n        return deferredAjax.promise();\r\n    }\r\n}"]}